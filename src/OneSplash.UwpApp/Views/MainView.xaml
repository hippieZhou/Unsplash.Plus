<UserControl
    x:Class="OneSplash.UwpApp.Views.MainView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:animation="using:Microsoft.Toolkit.Uwp.UI.Animations"
    xmlns:common="using:OneSplash.UwpApp.Common"
    xmlns:control="using:OneSplash.UwpApp.Controls"
    xmlns:core="using:Microsoft.Xaml.Interactions.Core"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:extensions="using:Microsoft.Toolkit.Uwp.UI.Extensions"
    xmlns:interactivity="using:Microsoft.Xaml.Interactivity"
    xmlns:local="using:OneSplash.UwpApp.Views"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:model="using:OneSplash.UwpApp.Models"
    xmlns:toolkit="using:Microsoft.Toolkit.Uwp.UI.Controls"
    xmlns:winui="using:Microsoft.UI.Xaml.Controls"
    d:DesignHeight="1080"
    d:DesignWidth="1920"
    mc:Ignorable="d">
    <UserControl.Resources>
        <DataTemplate x:Key="CategoryTemplate" x:DataType="x:String">
            <Grid HorizontalAlignment="Stretch" Loaded="CategoryGrid_Loaded">
                <Canvas x:Name="ShadowContainer" />
                <Grid
                    Width="200"
                    Height="120"
                    Background="{x:Bind}"
                    CornerRadius="4">
                    <TextBlock
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        FontFamily="{StaticResource MontserratBold}"
                        Foreground="{StaticResource SystemBaseHighColor}"
                        Text="{x:Bind}" />
                </Grid>
            </Grid>
        </DataTemplate>
        <DataTemplate x:Key="RecipeTemplate" x:DataType="model:Splash">
            <Grid Loaded="RecipeGrid_Loaded">
                <toolkit:ImageEx
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch"
                    HorizontalContentAlignment="Stretch"
                    VerticalContentAlignment="Stretch"
                    common:ImageLoader.Source="{x:Bind}"
                    EnableLazyLoading="True"
                    IsCacheEnabled="True"
                    Stretch="UniformToFill" />
                <TextBlock
                    x:Name="recipeName"
                    Margin="12,0,0,12"
                    HorizontalAlignment="Left"
                    VerticalAlignment="Bottom"
                    extensions:VisualExtensions.CenterPoint="50,50,0"
                    FontFamily="{StaticResource MontserratBold}"
                    Opacity="0.8"
                    Style="{StaticResource BodyTextBlockStyle}"
                    Text="{x:Bind ImageAuthor}"
                    TextWrapping="NoWrap"
                    Visibility="Collapsed">
                    <animation:Implicit.ShowAnimations>
                        <animation:TranslationAnimation
                            From="0, -32, 0"
                            To="0"
                            Duration="0:0:2" />
                        <animation:OpacityAnimation
                            From="0"
                            To="1.0"
                            Duration="0:0:2" />
                    </animation:Implicit.ShowAnimations>
                    <animation:Implicit.HideAnimations>
                        <animation:TranslationAnimation
                            From="0"
                            To="0, -32, 0"
                            Duration="0:0:1" />
                        <animation:OpacityAnimation
                            From="1.0"
                            To="0"
                            Duration="0:0:1" />
                    </animation:Implicit.HideAnimations>
                </TextBlock>

                <interactivity:Interaction.Behaviors>
                    <core:EventTriggerBehavior EventName="PointerEntered">
                        <core:ChangePropertyAction
                            PropertyName="Visibility"
                            TargetObject="{Binding ElementName=recipeName}"
                            Value="Visible" />
                    </core:EventTriggerBehavior>
                    <core:EventTriggerBehavior EventName="PointerExited">
                        <core:ChangePropertyAction
                            PropertyName="Visibility"
                            TargetObject="{Binding ElementName=recipeName}"
                            Value="Collapsed" />
                    </core:EventTriggerBehavior>
                </interactivity:Interaction.Behaviors>
            </Grid>
        </DataTemplate>
    </UserControl.Resources>
    <interactivity:Interaction.Behaviors>
        <core:EventTriggerBehavior EventName="Loaded">
            <core:InvokeCommandAction Command="{x:Bind ViewModel.LoadCommand}" />
        </core:EventTriggerBehavior>
    </interactivity:Interaction.Behaviors>

    <Grid Padding="0,24,0,0">
        <toolkit:AdaptiveGridView
            animation:ReorderGridAnimation.Duration="300"
            DataFetchSize="2"
            DesiredWidth="360"
            IncrementalLoadingThreshold="2"
            IncrementalLoadingTrigger="Edge"
            IsItemClickEnabled="True"
            ItemHeight="240"
            ItemTemplate="{StaticResource RecipeTemplate}"
            ItemsSource="{x:Bind ViewModel.FilteredRecipeData, Mode=OneWay}"
            OneRowModeEnabled="False"
            SelectionMode="None"
            StretchContentForSingleRow="True">
            <toolkit:AdaptiveGridView.ItemContainerStyle>
                <Style BasedOn="{StaticResource BaseGridViewItemContainerStyle}" TargetType="GridViewItem">
                    <Setter Property="Margin" Value="24" />
                </Style>
            </toolkit:AdaptiveGridView.ItemContainerStyle>
            <toolkit:AdaptiveGridView.ItemContainerTransitions>
                <TransitionCollection>
                    <EntranceThemeTransition FromVerticalOffset="240" IsStaggeringEnabled="True" />
                </TransitionCollection>
            </toolkit:AdaptiveGridView.ItemContainerTransitions>
            <toolkit:AdaptiveGridView.Header>
                <control:StepThroughListView
                    Margin="12,24,24,24"
                    extensions:VisualExtensions.NormalizedCenterPoint="0.5,0.5,0"
                    ItemTemplate="{StaticResource CategoryTemplate}"
                    ItemsSource="{x:Bind ViewModel.Categories, Mode=OneWay}">
                    <animation:Implicit.ShowAnimations>
                        <animation:TranslationAnimation
                            From="0,40,0"
                            To="0,0,0"
                            Duration="0:0:0.6" />
                        <animation:ScaleAnimation
                            From="0.6"
                            To="1"
                            Duration="0:0:0.6" />
                        <animation:OpacityAnimation
                            From="0"
                            To="1"
                            Duration="0:0:0.6" />
                    </animation:Implicit.ShowAnimations>
                </control:StepThroughListView>
            </toolkit:AdaptiveGridView.Header>
            <toolkit:AdaptiveGridView.Footer>
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                    <TextBlock Text="{x:Bind ViewModel.FilteredRecipeData.IsLoading, Converter={StaticResource StringFormatConverter}, ConverterParameter='Is Loading: {0}'}" />
                    <TextBlock Text="{x:Bind ViewModel.FilteredRecipeData.HasMoreItems, Converter={StaticResource StringFormatConverter}, ConverterParameter='Has More Items: {0}'}" />
                </StackPanel>
            </toolkit:AdaptiveGridView.Footer>
        </toolkit:AdaptiveGridView>
    </Grid>
</UserControl>
